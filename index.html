<?php
// request-allocation.php
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request Allocation - Research Computing Data Core</title>
    
    <style>
        /* Maintain UH theme colors and styles */
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background-color: #f5f5f5;
        }
        
        /* Header styles */
        .uh-header {
            background-color: #C8102E;
            color: white;
            padding: 20px 0;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .uh-logo {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: white;
        }
        
        .uh-logo img {
            height: 40px;
            margin-right: 10px;
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
        }
        
        /* Main content area */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            min-height: 600px;
        }
        
        .breadcrumb {
            color: #666;
            margin-bottom: 30px;
        }
        
        .breadcrumb a {
            color: #C8102E;
            text-decoration: none;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        
        /* Form selection styles */
        .form-selector {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .form-selector h2 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .form-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            max-width: 800px;
        }
        
        .form-option {
            background: white;
            border: 2px solid #ddd;
            padding: 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .form-option:hover {
            border-color: #C8102E;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .form-option.selected {
            border-color: #C8102E;
            background-color: #fef5f5;
        }
        
        .form-option input[type="radio"] {
            margin-right: 10px;
        }
        
        .form-option label {
            display: block;
            cursor: pointer;
            font-weight: 500;
            color: #333;
        }
        
        .form-description {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        .submit-btn {
            background-color: #C8102E;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        
        .submit-btn:hover {
            background-color: #a00825;
        }
        
        .submit-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        /* Form display container */
        .form-container {
            display: none;
            margin-top: 30px;
        }
        
        .form-container.active {
            display: block;
        }
        
        .form-notice {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .form-notice h3 {
            margin-top: 0;
            color: #155724;
        }
        
        .form-notice p {
            color: #155724;
            margin: 10px 0;
        }
        
        .open-form-btn {
            background-color: #C8102E;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 10px 0;
            transition: background-color 0.3s;
        }
        
        .open-form-btn:hover {
            background-color: #a00825;
        }
        
        .form-links {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 4px;
            margin-top: 20px;
        }
        
        .form-links h4 {
            margin-top: 0;
            color: #333;
        }
        
        .link-option {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .link-option a {
            color: #C8102E;
            text-decoration: none;
            font-weight: 500;
        }
        
        .link-option a:hover {
            text-decoration: underline;
        }
        
        .back-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        
        .back-btn:hover {
            background-color: #5a6268;
        }
        
        /* Loading indicator */
        .loading-indicator {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #C8102E;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Sidebar styles */
        .content-wrapper {
            display: flex;
            gap: 30px;
        }
        
        .sidebar {
            width: 300px;
            flex-shrink: 0;
        }
        
        .sidebar-section {
            background: #f9f9f9;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .sidebar-section h3 {
            color: #C8102E;
            margin-bottom: 15px;
            font-size: 16px;
            text-transform: uppercase;
        }
        
        .sidebar-links {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .sidebar-links li {
            margin-bottom: 10px;
        }
        
        .sidebar-links a {
            color: #C8102E;
            text-decoration: none;
        }
        
        .sidebar-links a:hover {
            text-decoration: underline;
        }
        
        .main-content {
            flex: 1;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .form-options {
                grid-template-columns: 1fr;
            }
            
            .content-wrapper {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .nav-links {
                margin-top: 15px;
            }
        }
        
        /* Hidden iframe for testing */
        .hidden-test-iframe {
            position: absolute;
            width: 1px;
            height: 1px;
            left: -1000px;
            top: -1000px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="uh-header">
        <div class="header-content">
            <a href="https://www.uh.edu" class="uh-logo">
                <span style="font-size: 24px; font-weight: bold;">UNIVERSITY OF HOUSTON</span>
            </a>
            <nav class="nav-links">
                <a href="#">Visit</a>
                <a href="#">Apply</a>
                <a href="#">Give</a>
            </nav>
        </div>
    </header>
    
    <!-- RCDC Header -->
    <div style="background-color: #8B1538; color: white; padding: 40px 0;">
        <div class="header-content">
            <h1 style="margin: 0; font-size: 48px; font-weight: 300;">Research Computing Data Core</h1>
        </div>
    </div>
    
    <!-- Navigation Bar -->
    <div style="background-color: #6d1229; color: white; padding: 15px 0;">
        <div class="header-content">
            <nav style="display: flex; gap: 30px;">
                <a href="#" style="color: white; text-decoration: none;">HPE DSI</a>
                <a href="#" style="color: white; text-decoration: none;">Getting Started ▼</a>
                <a href="#" style="color: white; text-decoration: none;">Resources ▼</a>
                <a href="#" style="color: white; text-decoration: none;">Support & Services ▼</a>
                <a href="#" style="color: white; text-decoration: none;">Acknowledgement</a>
            </nav>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-container">
        <div class="breadcrumb">
            <a href="https://uh.edu">UH Home</a> > 
            <a href="#">Division of Research</a> > 
            <a href="#">Research Computing Data Core</a> > 
            Request Allocation
        </div>
        
        <div class="content-wrapper">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3>Division of Research</h3>
                    <ul class="sidebar-links">
                        <li><a href="#">About</a></li>
                        <li><a href="#">Funding Opportunities</a></li>
                        <li><a href="#">Sponsored Projects</a></li>
                        <li><a href="#">Compliance</a></li>
                        <li><a href="#">News and Events</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>
                
                <div class="sidebar-section">
                    <h3>RCDC</h3>
                    <ul class="sidebar-links">
                        <li><a href="#">Getting Started</a></li>
                        <li><a href="#">Request Account</a></li>
                        <li style="background: #C8102E; margin: 0 -20px; padding: 10px 20px;">
                            <a href="#" style="color: white;">Request Allocation</a>
                        </li>
                        <li><a href="#">Resources</a></li>
                        <li><a href="#">Support & Services</a></li>
                        <li><a href="#">Acknowledgement</a></li>
                    </ul>
                </div>
                
                <div class="sidebar-section">
                    <h3>ANY QUESTIONS?</h3>
                    <p style="font-size: 14px; color: #666;">
                        We will be happy to answer any questions you may have about the allocation process at 
                        <a href="mailto:contact@hpedsi.uh.edu">contact@hpedsi.uh.edu</a>.
                    </p>
                </div>
            </aside>
            
            <!-- Main Content Area -->
            <div class="main-content">
                <h1>Request Resources/Allocation on RCDC Clusters</h1>
                
                <p>An allocation is a quantity of computing time and storage resources that are granted to a principal investigator (PI). 
                To apply for a PI account please refer to <a href="#" style="color: #C8102E;">Request Account</a>.</p>
                
                <p>The basic unit of computational resources is the service unit (SU), which represents the use of one core for one hour on the Sabine 
                Cluster. Allocations are intended to support researchers furthering specific research and have a duration of 1 year. Dedicated 
                resources acquired through the <a href="#" style="color: #C8102E;">Cluster Partnership Program</a> (Condo Model) are not governed by this allocation policy.</p>
                
                <p>It may take up to a week to process your request.</p>
                
                <div style="background: #f0f0f0; padding: 20px; border-radius: 4px; margin: 20px 0;">
                    <em>Please allow extra time if your request is for more than 250,000 SUs, because such cases require approval from the Director of HPE DSI.</em>
                </div>
                
                <!-- Form Selection -->
                <div class="form-selector" id="formSelector">
                    <h2>Select the type of allocation request:</h2>
                    <div class="form-options">
                        <div class="form-option" onclick="selectOption(this)">
                            <label>
                                <input type="radio" name="formType" value="storage">
                                <strong>Additional Storage Resources</strong>
                                <div class="form-description">Request additional storage for your existing project</div>
                            </label>
                        </div>
                        <div class="form-option" onclick="selectOption(this)">
                            <label>
                                <input type="radio" name="formType" value="renew">
                                <strong>Renew Existing Project</strong>
                                <div class="form-description">Annual renewal (by August 1st)</div>
                            </label>
                        </div>
                        <div class="form-option" onclick="selectOption(this)">
                            <label>
                                <input type="radio" name="formType" value="new">
                                <strong>New Project Allocation</strong>
                                <div class="form-description">Request resources for a new research project</div>
                            </label>
                        </div>
                        <div class="form-option" onclick="selectOption(this)">
                            <label>
                                <input type="radio" name="formType" value="compute">
                                <strong>Additional Compute Resources</strong>
                                <div class="form-description">Request additional compute resources for your project</div>
                            </label>
                        </div>
                    </div>
                    <button class="submit-btn" id="continueBtn" onclick="showSelectedForm()" disabled>Continue to Form</button>
                </div>
                
                <!-- Form Container -->
                <div class="form-container" id="formContainer">
                    <div class="loading-indicator" id="loadingIndicator">
                        <div class="spinner"></div>
                        <p>Preparing your form...</p>
                    </div>
                    
                    <div class="form-notice" id="formNotice" style="display: none;">
                        <h3>Ready to Complete Your Request</h3>
                        <p>Click the button below to open the allocation request form in a secure Microsoft Forms window.</p>
                        <button class="open-form-btn" id="openFormBtn" onclick="openFormInNewWindow()">
                            Open Request Form
                        </button>
                        <p style="font-size: 14px; color: #666; margin-top: 15px;">
                            The form will open in a new window. Please disable pop-up blockers if the form doesn't appear.
                        </p>
                    </div>
                    
                    <div class="form-links" id="alternativeLinks" style="display: none;">
                        <h4>Alternative Access Options:</h4>
                        <div class="link-option">
                            <strong>Option 1:</strong> 
                            <a href="#" id="directLink" target="_blank">Click here to open the form directly</a>
                        </div>
                        <div class="link-option">
                            <strong>Option 2:</strong> Copy this link and paste it in a new browser tab:
                            <div style="margin-top: 5px; padding: 10px; background: #f0f0f0; border-radius: 4px; word-break: break-all; font-family: monospace; font-size: 12px;" id="formUrlDisplay"></div>
                        </div>
                    </div>
                    
                    <button class="back-btn" onclick="resetForm()">← Back to Form Selection</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Hidden test iframe -->
    <iframe id="testFrame" class="hidden-test-iframe"></iframe>
    
    <script>
        // Form URLs - using the regular URLs without embed parameter
        const formUrls = {
            storage: 'https://forms.office.com/Pages/ResponsePage.aspx?id=vboLF_CikEytSw6PDwxCWUNNjUjgu1tNsgpg0NtTVe9UNlFRR1hGNFMwOUJEUDBXSDBSRDYyOTdJVy4u',
            renew: 'https://forms.office.com/Pages/ResponsePage.aspx?id=vboLF_CikEytSw6PDwxCWUNNjUjgu1tNsgpg0NtTVe9UNUNFVDdRRDNZRUpaME80RkVVV0IySURNVy4u',
            new: 'https://forms.office.com/Pages/ResponsePage.aspx?id=vboLF_CikEytSw6PDwxCWUNNjUjgu1tNsgpg0NtTVe9UNjhOTjY0UDQ3NllLVkhWS09UR1YxWE82Uy4u',
            compute: 'https://forms.office.com/Pages/ResponsePage.aspx?id=vboLF_CikEytSw6PDwxCWUNNjUjgu1tNsgpg0NtTVe9UQVBIS0hVRkI1UDBTV0JSOElLVkg1RTVRNy4u'
        };
        
        // Form titles for better UX
        const formTitles = {
            storage: 'Additional Storage Resources Request',
            renew: 'Project Renewal Request',
            new: 'New Project Allocation Request',
            compute: 'Additional Compute Resources Request'
        };
        
        let selectedFormType = null;
        let formWindow = null;
        
        // Handle option selection
        function selectOption(element) {
            // Remove selected class from all options
            document.querySelectorAll('.form-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Add selected class to clicked option
            element.classList.add('selected');
            
            // Check the radio button
            const radio = element.querySelector('input[type="radio"]');
            radio.checked = true;
            
            // Enable continue button
            document.getElementById('continueBtn').disabled = false;
            selectedFormType = radio.value;
        }
        
        // Show selected form
        function showSelectedForm() {
            const selectedOption = document.querySelector('input[name="formType"]:checked');
            
            if (!selectedOption) {
                alert('Please select a form type before continuing.');
                return;
            }
            
            selectedFormType = selectedOption.value;
            const formUrl = formUrls[selectedFormType];
            
            // Hide form selector
            document.getElementById('formSelector').style.display = 'none';
            
            // Show form container
            const formContainer = document.getElementById('formContainer');
            formContainer.classList.add('active');
            
            // Show loading indicator
            document.getElementById('loadingIndicator').style.display = 'block';
            document.getElementById('formNotice').style.display = 'none';
            document.getElementById('alternativeLinks').style.display = 'none';
            
            // Set up the form access
            setTimeout(() => {
                setupFormAccess(formUrl);
            }, 1000);
            
            // Scroll to form
            formContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // Setup form access
        function setupFormAccess(formUrl) {
            // Hide loading
            document.getElementById('loadingIndicator').style.display = 'none';
            
            // Show form notice
            document.getElementById('formNotice').style.display = 'block';
            
            // Set direct link
            document.getElementById('directLink').href = formUrl;
            
            // Set form URL display
            document.getElementById('formUrlDisplay').textContent = formUrl;
            
            // Show alternative links
            document.getElementById('alternativeLinks').style.display = 'block';
            
            // Update button text with form type
            const btnText = `Open ${formTitles[selectedFormType]}`;
            document.getElementById('openFormBtn').textContent = btnText;
        }
        
        // Open form in new window
        function openFormInNewWindow() {
            const formUrl = formUrls[selectedFormType];
            const windowName = 'MSFormsWindow';
            const windowFeatures = 'width=800,height=600,resizable=yes,scrollbars=yes,toolbar=no,menubar=no,location=no,directories=no,status=yes';
            
            // Close previous window if it exists
            if (formWindow && !formWindow.closed) {
                formWindow.close();
            }
            
            // Open new window
            formWindow = window.open(formUrl, windowName, windowFeatures);
            
            // Check if window was blocked
            if (!formWindow || formWindow.closed || typeof formWindow.closed == 'undefined') {
                alert('The form window was blocked by your browser.\n\nPlease disable pop-up blockers for this site or use one of the alternative access options below.');
            } else {
                // Focus the new window
                formWindow.focus();
                
                // Optional: Check if window is still open after a delay
                setTimeout(() => {
                    if (formWindow.closed) {
                        console.log('Form window was closed');
                    }
                }, 1000);
            }
        }
        
        // Reset form
        function resetForm() {
            // Show form selector
            document.getElementById('formSelector').style.display = 'block';
            
            // Hide form container
            document.getElementById('formContainer').classList.remove('active');
            
            // Reset selections
            const checkedRadio = document.querySelector('input[name="formType"]:checked');
            if (checkedRadio) {
                checkedRadio.checked = false;
            }
            
            // Remove selected class from all options
            document.querySelectorAll('.form-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Disable continue button
            document.getElementById('continueBtn').disabled = true;
            
            // Reset selected form type
            selectedFormType = null;
            
            // Close form window if open
            if (formWindow && !formWindow.closed) {
                formWindow.close();
            }
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Add keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (document.getElementById('formContainer').classList.contains('active')) {
                    resetForm();
                }
            }
        });
        
        // Warn user about leaving with form open
        window.addEventListener('beforeunload', function(e) {
            if (formWindow && !formWindow.closed) {
                return 'You have a form open in another window. Are you sure you want to leave?';
            }
        });
    </script>
</body>
</html>
